# Feature 4.3 ‚Äî Battle Interface

> **Objetivo:** Implementar tela de confronto interativa (A vs B) com integra√ß√£o ao sistema Elo.

---

## üéØ Objetivo

Criar interface funcional para confrontos entre fotos, permitindo que o usu√°rio escolha a melhor e atualize rankings Elo.

---

## üì¶ Escopo

### In Scope:
- [x] Interface de confronto (2 fotos lado a lado)
- [x] Intera√ß√£o: click, touch, atalhos (‚Üê ‚Üí ou 1, 2)
- [x] Feedback visual (borda, escala, anima√ß√£o)
- [x] Integra√ß√£o com `elo.js` (atualizar scores)
- [x] Progresso: "Confronto X de Y"
- [x] Persist√™ncia de estado (confrontos realizados)
- [x] L√≥gica de finaliza√ß√£o (quando acabarem confrontos)

### Out of Scope:
- ‚ùå Tela de resultados finais (F4.4)
- ‚ùå M√∫ltiplos contests (F4.5, F4.6)

---

## üß© Requisitos Funcionais (RF)

### RF1 ‚Äî Interface de Confronto
- **RF1.1**: Exibir 2 fotos lado a lado (desktop) ou verticais (mobile)
- **RF1.2**: Tamanho m√°ximo: 700√ó500px por foto
- **RF1.3**: Label: "Foto A" e "Foto B" (ou "1" e "2")
- **RF1.4**: Hover mostra feedback visual (escala, borda)

### RF2 ‚Äî Intera√ß√£o
- **RF2.1**: Click em foto A ‚Üí A vence
- **RF2.2**: Click em foto B ‚Üí B vence
- **RF2.3**: Atalho ‚Üê (ou 1) ‚Üí A vence
- **RF2.4**: Atalho ‚Üí (ou 2) ‚Üí B vence
- **RF2.5**: Touch funciona em mobile
- **RF2.6**: Esc cancela contest (com confirma√ß√£o)

### RF3 ‚Äî L√≥gica de Batalha
- **RF3.1**: Iniciar contest: gerar todos os pairings
- **RF3.2**: Exibir confronto atual (√≠ndice 0)
- **RF3.3**: Ao escolher: atualizar Elo, salvar hist√≥rico, pr√≥ximo confronto
- **RF3.4**: Progresso: "Confronto 3 de 10"
- **RF3.5**: Quando acabar: ir para aba "Resultados"

### RF4 ‚Äî Persist√™ncia
- **RF4.1**: Salvar estado do contest no IndexedDB:
  - `contestState.phase` = 'battle'
  - `contestState.eloScores` = { photoId: rating, ... }
  - `contestState.battleHistory` = [{ photoA, photoB, winner, timestamp }, ...]
  - `contestState.currentMatch` = { photoA, photoB, matchNumber }
- **RF4.2**: Recuperar estado ao reabrir aba (continuar de onde parou)
- **RF4.3**: Bot√£o "Recome√ßar" limpa estado

---

## üé® Requisitos N√£o Funcionais (RNF)

### RNF1 ‚Äî UX
- **RNF1.1**: Transi√ß√£o suave entre confrontos (fade-in)
- **RNF1.2**: Feedback imediato ao escolher (< 100ms)
- **RNF1.3**: Anima√ß√£o de vit√≥ria (borda verde, escala 1.05)
- **RNF1.4**: Toast: "Foto A venceu! (+15 Elo)"

### RNF2 ‚Äî Performance
- **RNF2.1**: Gera√ß√£o de pairings < 50ms para 20 fotos
- **RNF2.2**: Atualiza√ß√£o de scores < 10ms
- **RNF2.3**: Renderiza√ß√£o de confronto < 100ms

### RNF3 ‚Äî Acessibilidade
- **RNF3.1**: ARIA labels descritivos
- **RNF3.2**: Atalhos de teclado documentados
- **RNF3.3**: Foco vis√≠vel em fotos

---

## üß± Arquitetura

### Arquivos Novos:
- Nenhum (l√≥gica em `app.js`)

### Arquivos Modificados:
- `public/scripts/app.js` - Fun√ß√µes de contest
- `public/index.html` - HTML do confronto
- `public/styles/components.css` - Estilos de batalha
- `public/scripts/db.js` - Salvar `contestState`

---

## üìê Estrutura de Dados

### Contest State (IndexedDB):
```javascript
// Adicionar ao Photo object (opcional por enquanto):
{
  contestData: {
    phase: 'idle' | 'battle' | 'finished',
    eloScores: { [photoId]: number },
    battleHistory: Array<{
      photoA: string,
      photoB: string,
      winner: string,
      timestamp: number,
      eloChange: { winner: number, loser: number }
    }>,
    currentMatch: {
      photoA: Photo,
      photoB: Photo,
      matchNumber: number,
      totalMatches: number
    },
    champion: string | null
  }
}

// Ou criar entry no localStorage (mais simples para MVP):
localStorage.setItem('photoranker-contest-state', JSON.stringify(contestState));
```

---

## üé® HTML da Batalha

```html
<div class="contest-battle" id="contestBattle">
  <div class="contest-progress">
    Confronto <span class="current" id="matchNumber">1</span> de <span id="totalMatches">10</span>
  </div>
  
  <div class="battle-container">
    <!-- Foto A -->
    <div class="battle-photo" id="battlePhotoA" tabindex="0" role="button" aria-label="Escolher Foto A (1 ou ‚Üê)">
      <img src="" alt="Foto A" id="battleImgA">
      <div class="battle-label">1</div>
      <div class="battle-elo" id="eloA">Elo: 1500</div>
    </div>
    
    <!-- VS -->
    <div class="battle-vs">
      <span>VS</span>
    </div>
    
    <!-- Foto B -->
    <div class="battle-photo" id="battlePhotoB" tabindex="0" role="button" aria-label="Escolher Foto B (2 ou ‚Üí)">
      <img src="" alt="Foto B" id="battleImgB">
      <div class="battle-label">2</div>
      <div class="battle-elo" id="eloB">Elo: 1500</div>
    </div>
  </div>
  
  <div class="battle-actions">
    <button class="btn btn-secondary" id="cancelContest">Cancelar Contest</button>
  </div>
</div>
```

---

## ‚úÖ Definition of Done

- [ ] Interface de confronto funcional
- [ ] Atalhos de teclado (‚Üê, ‚Üí, 1, 2, Esc)
- [ ] Integra√ß√£o com `elo.js`
- [ ] Persist√™ncia de estado (localStorage)
- [ ] Anima√ß√µes e feedback visual
- [ ] Progresso atualizado
- [ ] Navega√ß√£o para "Resultados" ao terminar
- [ ] 10 casos de teste passando
- [ ] Sem erros de linter
- [ ] Docs atualizadas

---

## üîó Depend√™ncias

- **Depende de:** F4.1 (UI Base), F4.2 (Elo Logic)
- **Bloqueia:** F4.4 (Results)

---

**Estimativa:** 2-3 horas  
**Prioridade:** Alta  
**Complexidade:** M√©dia-Alta

