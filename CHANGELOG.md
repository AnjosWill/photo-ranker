# Changelog
Este projeto segue o formato **Keep a Changelog** e **SemVer**.

## [v0.3.0] ‚Äî 2025-10-31 (Sprint 3)
### ‚ú® Funcionalidades
**Sistema de Avalia√ß√£o por Estrelas (1-5):**
- **Componente de Estrelas Interativo**
  - Interface visual de 5 estrelas com feedback em tempo real
  - Hover preview (pr√©-visualiza√ß√£o) ao passar o mouse
  - Suporte completo a touch (mobile)
  - Anima√ß√µes suaves e efeitos visuais (glow, scale)
  - Cor dourada (#FFD700) para estrelas preenchidas
- **Integra√ß√£o no Grid (Aba "Upload")**
  - Estrelas aparecem ao passar mouse sobre o card
  - Sempre vis√≠veis se foto j√° foi avaliada
  - Click em estrela N√ÉO abre o viewer (event.stopPropagation)
  - Atualiza√ß√£o instant√¢nea do badge ap√≥s avalia√ß√£o
- **Integra√ß√£o no Viewer Fullscreen**
  - Estrelas centralizadas abaixo da imagem
  - Atalhos de teclado: 1-5 para avaliar, Shift+0 para resetar zoom
  - Sincroniza√ß√£o autom√°tica ao navegar (‚Üê/‚Üí)
  - Feedback visual imediato com toast
- **Aba "Avaliar" Funcional**
  - Interface dedicada para ranqueamento sequencial
  - Foto grande centralizada com estrelas logo abaixo
  - Navega√ß√£o: bot√µes "‚Üê Anterior" e "Pr√≥xima ‚Üí"
  - Progresso em tempo real: "Foto X de Y (Z avaliadas)"
  - Filtro "Mostrar apenas n√£o avaliadas" (checkbox)
  - Estado vazio: "Todas as fotos j√° foram avaliadas! üéâ"
  - Atalhos de teclado:
    - `‚Üê/‚Üí`: Navegar entre fotos
    - `1-5`: Avaliar foto atual
    - `0`: Remover avalia√ß√£o
    - `Esc`: Voltar para aba Upload

**Sistema de Filtros:**
- **Tabs de Filtragem (Aba "Upload")**
  - "Todas" (padr√£o)
  - "‚≠ê 5 estrelas" (apenas fotos nota m√°xima)
  - "N√£o avaliadas" (fotos sem rating ou rating = 0)
- **Contadores Din√¢micos**
  - Cada tab mostra quantidade de fotos
  - Atualiza√ß√£o instant√¢nea ao avaliar
  - Persist√™ncia ao fazer upload de novas fotos
- **Interface Responsiva**
  - Tabs horizontais no desktop
  - Dropdown vertical no mobile
  - Transi√ß√µes suaves entre filtros

**Persist√™ncia e Metadados:**
- Campo `rating` (0-5) em todas as fotos
- `rating = 0` significa "n√£o avaliado" (padr√£o)
- Campo `evaluatedAt` (timestamp) quando foto √© avaliada
- √çndice IndexedDB otimizado para queries de rating
- Migra√ß√£o autom√°tica de fotos antigas (adiciona rating = 0)

### üé® UX e Interface
- **Feedback T√°til**: Vibra√ß√£o curta no mobile ao avaliar (50ms)
- **Toasts Informativos**: "Avaliada com X estrelas!" / "Avalia√ß√£o removida"
- **Badges Visuais**:
  - "‚òÖ X" (azul) quando foto tem rating
  - "Novo" (roxo) quando foto n√£o tem rating
  - "Cortado" (verde) para fotos divididas em 2√ó2
  - Empilhamento vertical sem cobrir a imagem
- **Anima√ß√µes Suaves**:
  - Estrelas com scale (1.15x) e glow ao hover
  - Transition em 150ms para todas as intera√ß√µes
  - Drop shadow nas estrelas preenchidas
- **Responsividade**:
  - Estrelas 24px (mobile) ‚Üí 28px (desktop)
  - Layout da aba "Avaliar" adaptado (vertical no mobile)
  - Filtros em dropdown no mobile, tabs no desktop

### ‚ôø Acessibilidade (A11Y)
- **Componente de Estrelas**:
  - `role="radiogroup"` no container
  - `role="radio"` e `aria-checked` em cada estrela
  - `aria-label` descritivo: "Avalia√ß√£o: X de 5 estrelas"
  - Navega√ß√£o por Tab, Enter/Space para selecionar
  - Setas (‚Üê/‚Üí) para navegar entre estrelas
- **Atalhos de Teclado Globais**:
  - `1-5`: Avaliar foto em foco no grid
  - `0`: Remover avalia√ß√£o
  - N√£o conflita com atalhos existentes (U, S, Esc, Delete)
- **Screen Reader**:
  - An√∫ncio via `aria-live` ao avaliar
  - Labels claros em todos os controles
  - Progresso acess√≠vel na aba "Avaliar"
- **Contraste WCAG AA**: Estrelas douradas ‚â• 4.5:1

**Sistema de Ordena√ß√£o:**
- **8 Op√ß√µes de Ordena√ß√£o**:
  - üìÖ Data (mais recente/mais antiga)
  - ‚≠ê Avalia√ß√£o (maior/menor)
  - üì¶ Tamanho em pixels (maior/menor)
  - üìè Dimens√£o/Resolu√ß√£o (maior/menor)
- **Persist√™ncia**: Prefer√™ncia salva no localStorage
- **Sincroniza√ß√£o**: Mesma ordem em grid, viewer e aba "Avaliar"
- **UI**: Dropdown com √≠cones sem√¢nticos

**Otimiza√ß√µes de UX:**
- **Manuten√ß√£o de Scroll**:
  - Avaliar nas miniaturas: mant√©m posi√ß√£o exata
  - Avaliar no viewer: faz scroll ao fechar + destaque visual
  - Dividir/Reverter: mant√©m foco na foto resultante
- **Viewer com Filtros**: √çndices sincronizados (abre foto correta)
- **Bot√£o "Limpar" Contextual**:
  - Respeita filtro ativo (remove apenas fotos vis√≠veis)
  - Mensagem detalhada: "Remover√° X foto(s) [filtro]"
- **Layout Responsivo**:
  - Aba "Avaliar" sem scroll (elementos distribu√≠dos)
  - Header compacto (padding reduzido)
  - Grid 1 coluna em telas < 400px (evita vazamento)
- **Estrelas nos Cards**:
  - Tamanho adaptativo: 20px ‚Üí 16px (mobile) ‚Üí 18px (mini)
  - `max-width` para nunca vazar do card
  - Gap reduzido em telas pequenas

### üêõ Corre√ß√µes
- **Migra√ß√£o de Dados**: Fotos antigas recebem `rating = 0` automaticamente
- **Upload**: Novas fotos j√° incluem `rating = 0` e `uploadedAt`
- **Filtros**: Re-renderiza√ß√£o correta ao trocar filtro ativo
- **Viewer**: 
  - Atalho `0` remove rating, `Shift+0` reseta zoom
  - Abre foto correta mesmo com filtros/ordena√ß√£o ativos
  - Rating visual persiste ao navegar
  - Fecha e faz scroll at√© √∫ltima foto visualizada
- **Grid**: 
  - Click em estrelas n√£o abre viewer (stopPropagation)
  - Scroll mant√©m posi√ß√£o ao avaliar nas miniaturas
  - √çcones adicionados no dropdown de ordena√ß√£o
- **Aba "Avaliar"**:
  - Atalhos de teclado (1-5) atualizam estrelas visualmente
  - Delay 300ms antes de avan√ßar automaticamente
  - Progresso mostra total geral mesmo com checkbox marcado
  - Foco mant√©m ao alternar checkbox "apenas n√£o avaliadas"
  - Layout sem scroll em desktop e mobile
  - Bot√µes lado a lado em mobile
- **Badge "Novo"**: Removido ao avaliar, reaparece se rating = 0
- **Tab Navigation**: Todas as 5 estrelas tabul√°veis (antes s√≥ a 1¬™)

### üìÑ Documenta√ß√£o
- `SPRINT3_PLAN.md`: Planejamento detalhado com RF/RNF
- `SPRINT3_TESTS.md`: 41 casos de teste (8 categorias)
- `README.md`: Atualizado com features da Sprint 3
- `PROJECT_PLAN.md`: Status da Sprint 3 marcado como conclu√≠do
- C√≥digo limpo: removidas fun√ß√µes n√£o utilizadas (`blobToDataURL`, `loadImageFromURL`)

---

## [v0.2.0] ‚Äî 2025-10-28 (Sprint 2)
### ‚ú® Funcionalidades
**Detec√ß√£o e Divis√£o 2√ó2:**
- **Detec√ß√£o autom√°tica de imagens 2√ó2** via Web Worker ass√≠ncrono
  - An√°lise heur√≠stica refinada baseada em similaridade entre quadrantes (>95%)
  - Performance: <500ms por imagem, execu√ß√£o paralela para m√∫ltiplas fotos
- **Modal de cropper interativo** com canvas HTML5
  - Guias ajust√°veis (verticais e horizontais) via mouse e touch
  - Preview em tempo real dos 4 quadrantes durante ajuste (HiDPI 2x)
  - Al√ßas de arrasto com 44√ó44px (WCAG)
- **Divis√£o manual** para fotos n√£o detectadas automaticamente
  - Bot√£o "Dividir em 2√ó2" nos cards e no viewer fullscreen
  - Fluxo id√™ntico ao autom√°tico: cropper ‚Üí ajuste ‚Üí confirmar
- **Fila de processamento** para m√∫ltiplas detec√ß√µes
  - Cropper abre sequencialmente para cada imagem detectada
  - Feedback de progresso: "Ajustando imagem X de Y"
  - Op√ß√£o de cancelar (Esc) e manter original
- **Extra√ß√£o de quadrantes** mantendo qualidade original (JPEG 0.95)
  - 4 fotos independentes criadas com metadados: `_parentId`, `_quadrant`

**Sistema de Reverter:**
- **Restaura√ß√£o de fotos originais** via bot√£o ‚Ü∫ (undo)
  - Remove todas as 4 fotos cortadas simultaneamente
  - Restaura original (remove flag `_isSplit`)
  - Modal de confirma√ß√£o antes de reverter
  - Dispon√≠vel nos cards (grid) e viewer fullscreen
  - Ap√≥s reverter no viewer, abre automaticamente a foto original

**Badges Visuais:**
- **Badge "Cortado"** (verde) para fotos divididas
- **Badge "Novo"** (roxo) para fotos sem rating
- Badges empilhados verticalmente (n√£o cobre a imagem)
- Tooltips customizados em todos os bot√µes de a√ß√£o

**Zoom e Navega√ß√£o no Viewer:**
- **Zoom at√© 4x** com m√∫ltiplos m√©todos:
  - Scroll do mouse
  - Pinch-to-zoom (mobile)
  - Bot√µes +/- e reset (‚äó)
  - Atalhos de teclado: +, -, 0
- **Pan (arrastar)** quando com zoom ativo
  - Cursor muda para grab/grabbing
  - Limites inteligentes para n√£o arrastar muito al√©m
  - Suporte touch (1 dedo) no mobile
- **Canvas grande fixo**: 90vw √ó 82vh (max 1600√ó900px)
  - Imagens escalam para preencher o espa√ßo (`object-fit: contain`)
  - Melhor aproveitamento da tela em desktops
- **Controles visuais**: Painel flutuante (canto inferior esquerdo)
  - N√≠vel de zoom em % (atualiza√ß√£o em tempo real)
  - Bot√µes com tooltips informativos
  - Responsivo: menor no mobile

### üé® UX e Interface
- **Modal responsivo** do cropper (95vw max 900px)
  - Canvas com `object-fit: contain` para sempre mostrar imagem completa
  - Preview grid adaptativo: 4 colunas (desktop) ‚Üí 2 colunas (mobile)
  - Previews HiDPI com `imageSmoothingQuality: 'high'`
  - Bot√µes em coluna no mobile para melhor usabilidade
- **Tooltips customizados** com `data-tooltip` em todos os bot√µes
  - Anima√ß√£o suave (fade-in 200ms)
  - Setas adaptativas (canto inferior nos cards, canto superior no viewer)
  - Evita conflito com tooltips nativos do browser
- **Hierarquia de z-index correta**:
  - Header: 10 (sempre no topo)
  - Photo-actions: 5 (bot√µes dos cards)
  - Viewer: 1000 (fullscreen)
  - Cropper: 10000 (sobrep√µe tudo)
  - Controles do viewer: 9999 (bot√µes flutuantes)
- **Toasts informativos** em cada etapa do fluxo
- **Hint no cropper**: "Arraste as guias para ajustar o corte"
- **√çcones sem√¢nticos**: ‚Ü∫ para reverter, ‚äó para grade/reset

### ‚ôø Acessibilidade (A11Y)
- **Modal com `role="dialog"` e `aria-modal="true"`**
- **Trap de foco** entre bot√µes (Tab/Shift+Tab)
- **Esc fecha modal** mesmo durante drag de guias
- **Enter confirma** corte quando foco no bot√£o
- **Atalhos de teclado no viewer**:
  - ‚Üê/‚Üí para navegar entre fotos
  - Delete para remover
  - +/- para zoom, 0 para reset
- **Labels ARIA** em todos os elementos interativos
- **Tooltips descritivos** em todos os bot√µes de a√ß√£o
- **Al√ßas de 44√ó44px** (WCAG) para toque confort√°vel

### üß± Arquitetura
- Novo m√≥dulo `cropper.js` (ESM) com fun√ß√µes exportadas.
- Novo worker `quad-worker.js` para an√°lise ass√≠ncrona.
- Integra√ß√£o no fluxo de upload (`app.js`):
  - An√°lise ‚Üí Fila ‚Üí Cropper ‚Üí Salvamento.
- Estrutura de dados preparada para evolu√ß√£o futura (`projectId` opcional).

### üêõ Corre√ß√µes
**Detec√ß√£o e Worker:**
- Filtro de fotos com `_isSplit` no `renderGrid()` e viewer
- Timeout de seguran√ßa (500ms) nos workers para evitar travamentos
- Cleanup de workers ap√≥s an√°lise (previne vazamento de mem√≥ria)
- Algoritmo refinado para reduzir falsos positivos/negativos:
  - Foco em similaridade muito alta entre quadrantes (‚â•95%)
  - Rejei√ß√£o de fotos √∫nicas cortadas (similaridade 70-90%)

**Cropper Modal:**
- Canvas com `object-fit: contain` para evitar distor√ß√£o
- C√°lculo de `displaySize` corrigido (l√≥gica "contain" padr√£o)
- Promise resolve antes de `closeCropper()` para evitar erro
- `requestAnimationFrame` para garantir dimens√µes corretas do modal
- Previews proporcionais (n√£o mais for√ßados a 80√ó80 quadrado)
- Debounce no resize para performance

**UI/UX:**
- Tooltips com `data-tooltip` (n√£o mais `title`) para controle total
- `overflow: hidden` removido de `.photo-card` (tooltips cortados)
- `z-index` corrigido: photo-actions (5) < header (10)
- Bot√µes flutuantes do viewer com `position: fixed` (n√£o sobrep√µem imagem)
- Viewer n√£o fecha/reabre ao cancelar cropper (evita flicker)
- Badge "Novo" mostra mesmo em fotos cortadas (se `!rating`)
- √çcone de reverter trocado de üè† para ‚Ü∫ (mais sem√¢ntico)

### üìÑ Documenta√ß√£o
- PROJECT_PLAN.md atualizado com vis√£o de m√∫ltiplos contests (Sprints 4-5).
- README.md atualizado com features da Sprint 2.

---

## [v0.1.0] ‚Äî 2025-10-26 (Sprint 1)
### ‚ú® Funcionalidades
- Upload m√∫ltiplo com progresso global (quantidade conclu√≠da).
- Persist√™ncia via IndexedDB.
- Visualiza√ß√£o fullscreen com navega√ß√£o e remo√ß√£o com confirma√ß√£o.
- Multi-sele√ß√£o de fotos + barra de a√ß√µes; ‚ÄúLimpar‚Äù inteligente.
- A11Y & atalhos (U, S, Esc, Delete); trap de foco no modal.
- UI mobile-first, responsiva, com microintera√ß√µes.

### üõ†Ô∏è Ajustes/UX
- √çcone ‚úï oculto no modo sele√ß√£o; checks s√≥ no modo sele√ß√£o.
- Toolbar harmonizada (Selecionar + Limpar √† esquerda; contador √† direita).
- Viewer bloqueia navega√ß√£o durante confirma√ß√£o.
- Bot√£o Limpar desabilitado quando n√£o h√° imagens.
- C√≥pia padronizada (‚ÄúX imagens‚Äù).

### üß± Base t√©cnica
- `base.css` (tokens/layout), `components.css` (componentes).
- `db.js`, `image-utils.js`, `app.js` modulados e com tratamento de erros.

<!-- Links de compara√ß√£o (preencher quando houver pr√≥xima vers√£o) -->
<!-- [v0.1.0]: https://github.com/AnjosWill/photo-ranker/releases/tag/v0.1.0 -->